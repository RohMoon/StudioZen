<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.studiozen.DTO.ReservationDTO">
    <resultMap id="ReservationDTO" type="com.example.studiozen.DTO.ReservationDTO">
        <result property="reserv_no" column="reserv_no"/>
        <result property="reserv_hostcode" column="reserv_hostcode"/>
        <result property="reserv_date" column="reserv_date"/>
        <result property="reserv_regdate" column="reserv_regdate"/>
        <result property="reserv_start_time" column="reserv_start_time"/>
        <result property="reserv_end_time" column="reserv_end_time"/>
        <result property="reserv_host_mobile" column="reserv_host_mobile"/>
        <result property="reserv_paystatement" column="reserv_paystatement"/>
        <result property="reserv_host_email" column="reserv_host_email"/>
        <result property="reserv_updatedate" column="reserv_updatedate"/>
        <result property="reserv_del_reason" column="reserv_del_reason"/>
        <result property="reserv_hostname" column="reserv_hostname"/>
        <result property="reserv_space" column="reserv_space"/>
        <result property="reserv_pay_limited" column="reserv_pay_limited"/>
    </resultMap>
    <select id="reservation_BookedTimeSelect" parameterType="com.example.studiozen.DTO.ReservationDTO" resultType="com.example.studiozen.DTO.ReservationDTO" statementType="PREPARED">
        SELECT
            RESERV_START_TIME,
            RESERV_END_TIME,
            RESERV_DEL_SIGN
        FROM RESERVATION_MANAGE_TB
        WHERE SPACE_NO = #{space_no, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
        AND RESERV_DATE = #{reserv_date, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
    </select>


    <select id="reservation_Select" parameterType="com.example.studiozen.DTO.ReservationDTO" resultType="com.example.studiozen.DTO.ReservationDTO" statementType="PREPARED">
        SELECT
        ROWNUM row_num,
        BO.RESERV_NO,
        BO.SPACE_NO,
        sp.SPACE_NAME,
        sp.SPACE_BASICPRICE,
        BO.RESERV_HOSTCODE,
        BO.RESERV_DATE,
        BO.RESERV_START_TIME,
        BO.RESERV_END_TIME,
        BO.RESERV_HOST_MOBILE,
        BO.RESERV_PAYSTATEMENT,
        BO.RESERV_HOST_EMAIL,
        BO.RESERV_UPDATEDATE,
        BO.RESERV_DEL_SIGN,
        BO.RESERV_DEL_REASON,
        BO.RESERV_DEL_DATE,
        BO.RESERV_PAY_LIMITED,
        MEM.MEMBER_NAME as RESERV_HOSTNAME
        FROM(
        SELECT
        RSMT.RESERV_NO,
        RSMT.SPACE_NO,
        RSMT.RESERV_HOSTCODE,
        RSMT.RESERV_DATE,
        RSMT.RESERV_START_TIME,
        RSMT.RESERV_END_TIME,
        RSMT.RESERV_HOST_MOBILE,
        RSMT.RESERV_PAYSTATEMENT,
        RSMT.RESERV_HOST_EMAIL,
        RSMT.RESERV_UPDATEDATE,
        RSMT.RESERV_DEL_SIGN,
        RSMT.RESERV_DEL_REASON,
        RSMT.RESERV_DEL_DATE,
        RSMT.RESERV_PAY_LIMITED
        FROM RESERVATION_MANAGE_TB RSMT
        ) BO
        join MEMBER_TB MEM
        ON BO.RESERV_HOSTCODE = MEM.MEMBER_NO
        join SPACE_TB sp
        ON sp.SPACE_NO = BO.SPACE_NO
        WHERE RESERV_DEL_SIGN = 'N'
        <if test="reserv_hostcode != 'MEM282108'">
            AND BO.RESERV_HOSTCODE = #{reserv_hostcode, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
        </if>
        <if test="reserv_no_box !=null">
            And
            BO.RESERV_NO like '%'||#{wantSearchWord_box, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}||'%' </if>
        <if test="space_no_box !=null">
            And BO.SPACE_NO like '%'||#{wantSearchWord_box, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}||'%'</if>
        <if test="reserv_hostcode_box !=null">
            And BO.RESERV_HOSTCODE like '%'||#{wantSearchWord_box, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}||'%'</if>
        <if test="reserv_date_box !=null">
            And BO.RESERV_DATE like '%'||#{wantSearchWord_box, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}||'%'</if>
        <if test="reserv_start_time_box !=null">
            And BO.RESERV_START_TIME like '%'||#{wantSearchWord_box, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}||'%'</if>
        <if test="reserv_end_time_box !=null">
            And BO.RESERV_END_TIME like '%'||#{wantSearchWord_box, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}||'%'</if>
        <if test="reserv_host_mobile_box !=null">
            And BO.RESERV_HOST_MOBILE like '%'||#{wantSearchWord_box, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}||'%'</if>
        <if test="reserv_host_email_box !=null">
            And BO.RESERV_HOST_EMAIL like '%'||#{wantSearchWord_box, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}||'%'</if>
        <if test="reserv_paystatement_box !=null">
            And BO.RESERV_PAYSTATEMENT like '%'||#{wantSearchWord_box, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}||'%'</if>
    </select>

    <select id="reservation_CUD" parameterType="com.example.studiozen.DTO.ReservationDTO" resultType="com.example.studiozen.DTO.ReservationDTO" statementType="CALLABLE">
        {CALL Proc_RESERVATION_MANAGE_CUD(
             #{tr_code, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
            ,#{reserv_no, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
            ,#{space_no, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
            ,#{reserv_hostcode, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
            ,#{reserv_date, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
            ,#{reserv_start_time, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
            ,#{reserv_end_time, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
            ,#{reserv_paystatement, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
            ,#{reserv_hostname, mode=OUT, jdbcType=VARCHAR, javaType=java.lang.String}
            ,#{reserv_space, mode=OUT, jdbcType=VARCHAR, javaType=java.lang.String}
            ,#{reserv_pay_limited, mode=OUT, jdbcType=VARCHAR, javaType=java.lang.String}
            ,#{result, mode=OUT, jdbcType=NUMERIC, javaType=java.lang.Integer}
            )}
    </select>
    <select id="reservation_Detail" parameterType="com.example.studiozen.DTO.ReservationDTO" resultType="com.example.studiozen.DTO.ReservationDTO" statementType="PREPARED">

        select
            reserv.RESERV_NO            ,
            reserv.SPACE_NO             ,
            sp.    SPACE_NAME           ,
            reserv.RESERV_HOSTCODE      ,
            mem.   MEMBER_NAME          as RESERV_HOSTNAME,
            reserv.RESERV_DATE          ,
            reserv.RESERV_START_TIME    ,
            reserv.RESERV_END_TIME      ,
            reserv.RESERV_HOST_MOBILE   ,
            reserv.RESERV_PAYSTATEMENT  ,
            reserv.RESERV_REGDATE       ,
            reserv.RESERV_HOST_EMAIL    ,
            reserv.RESERV_UPDATEDATE    ,
            reserv.RESERV_DEL_SIGN      ,
            reserv.RESERV_DEL_REASON    ,
            reserv.RESERV_DEL_DATE      ,
            reserv.RESERV_PAY_LIMITED
        from RESERVATION_MANAGE_TB reserv
                 join MEMBER_TB mem
                      on reserv.RESERV_HOSTCODE = mem.MEMBER_NO
                 join SPACE_TB sp
                      on reserv.SPACE_NO = sp.SPACE_NO
                where reserv.RESERV_NO = #{reserv_no, mode=IN, jdbcType=VARCHAR, javaType=java.lang.String}
    </select>
    <select id="AutoFilled" parameterType="com.example.studiozen.DTO.ReservationDTO" resultType="com.example.studiozen.DTO.ReservationDTO" statementType="PREPARED">
    SELECT
    RESERV_NO
    FROM RESERVATION_MANAGE_TB
    where RESERV_NO like '%'||:x||'%'
    UNION ALL
    select
    SPACE_NO
    FROM RESERVATION_MANAGE_TB
    where SPACE_NO like '%'||:x||'%'
    UNION ALL
    select
    RESERV_HOSTCODE
    FROM RESERVATION_MANAGE_TB
    where RESERV_HOSTCODE like '%'||:x||'%'
    UNION ALL
    select
    TO_CHAR(RESERV_DATE)
    FROM RESERVATION_MANAGE_TB
    where TO_CHAR(RESERV_DATE) like '%'||:x||'%'
    UNION ALL
    select
    to_char(RESERV_START_TIME)
    FROM RESERVATION_MANAGE_TB
    where to_char(RESERV_START_TIME) like '%'||:x||'%'
    UNION ALL
    select
    to_char(RESERV_END_TIME)
    FROM RESERVATION_MANAGE_TB
    where to_char(RESERV_END_TIME) like '%'||:x||'%'
    UNION ALL
    select
    TO_CHAR(RESERV_HOST_MOBILE)
    FROM RESERVATION_MANAGE_TB
    where TO_CHAR(RESERV_HOST_MOBILE) like '%'||:x||'%'
    UNION ALL
    select
    TO_CHAR(RESERV_REGDATE)
    FROM RESERVATION_MANAGE_TB
    where TO_CHAR(RESERV_REGDATE) like '%'||:x||'%'
    UNION ALL
    select
    RESERV_HOST_EMAIL
    FROM RESERVATION_MANAGE_TB
    where RESERV_HOST_EMAIL like '%'||:x||'%'
    </select>

</mapper>
